services:
  # Backend Django Service (Free Tier)
  - type: web
    name: mediremind-backend
    runtime: python
    buildCommand: "bash build.sh"
    startCommand: "gunicorn mediremind_backend.wsgi:application --bind 0.0.0.0:$PORT"
    plan: free
    region: oregon
    branch: main
    healthCheckPath: /health/
    envVars:
      - key: DATABASE_URL
        value: "postgresql://postgres.mvaoaynbcnhpdzacrxvc:p0ZAXIzqFM1FM5NV@aws-0-eu-west-2.pooler.supabase.com:6543/postgres"
      - key: DJANGO_SECRET_KEY
        generateValue: true
      - key: DEBUG
        value: "false"
      - key: ENVIRONMENT
        value: "production"
      - key: REDIS_URL
        value: "redis://default:oE1Gh8TkVwGkuihbKt43XrQeZVTLbl4p@redis-12735.crce204.eu-west-2-3.ec2.redns.redis-cloud.com:12735/0"
      - key: CALENDAR_TOKEN_ENCRYPTION_KEY
        generateValue: true
      - key: FIELD_ENCRYPTION_KEY
        value: "ZmDfcTF7_60GrrY167zsiPd67pEvs0aGOv2oasOM1Pg="
      - key: ENCRYPTION_KEY_VERSION
        value: "v1"
      - key: ENCRYPTION_BACKUP_KEYS
        value: "{}"
      - key: VAPID_PUBLIC_KEY
        value: "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUZrd0V3WUhLb1pJemowQ0FRWUlLb1pJemowREFRY0RRZ0FFbld6TEFmcm1mK1RlZ1NpUkpPMWdoVlcxN3Z0ZgpNbmdiS1JqTERxRE9mTnZKTTY3S1BybmYxY3M4RTVIT2JUckowS1hqeXlXNHUwN3ArOGNZakRhSzBnPT0KLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg"
      - key: VAPID_PRIVATE_KEY
        generateValue: true
      - key: VAPID_ADMIN_EMAIL
        value: "bouricenos0@gmail.com"
      - key: DEFAULT_FROM_EMAIL
        value: "onboarding@resend.dev"
      - key: EMAIL_SERVICE
        value: "resend"
      - key: RESEND_API_KEY
        generateValue: true  # Set this in Render dashboard
      - key: RESEND_FROM_EMAIL
        value: "onboarding@resend.dev"
      - key: RESEND_FROM_NAME
        value: "MediRemind"
      - key: FRONTEND_URL
        fromService:
          type: web
          name: mediremind-frontend
          property: host

  # Frontend React Service (Free Static Site)
  - type: web
    name: mediremind-frontend
    runtime: static
    buildCommand: cd staff-portal && npm ci && npx vite build
    staticPublishPath: staff-portal/dist
    pullRequestPreviewsEnabled: false
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      - key: VITE_API_URL
        value: https://mediremind-backend-cl6r.onrender.com
      - key: REACT_APP_API_BASE_URL
        value: https://mediremind-backend-cl6r.onrender.com